BootStrap: debootstrap
MirrorURL: https://community-packages.deepin.com/deepin/
OSVersion: apricot 

%post
  dpkg --add-architecture i386
  apt update
  apt install -y --no-install-recommends locales procps x11-utils winbind fonts-wqy-microhei wget kmod
  echo 'zh_CN.UTF-8 UTF-8' > /etc/locale.gen 
  locale-gen 

  apt install -y --no-install-recommends deepin.com.wechat
  wget https://dldir1.qq.com/weixin/Windows/WeChatSetup.exe -O /tmp/WeChatSetup.exe
  7z x -aoa /opt/apps/com.qq.weixin.deepin/files/files.7z -o/tmp/wechatdir
  rm -rf /tmp/wechatdir/drive_c/Program\ Files/Tencent/WeChat/*
  7z x -aoa /tmp/WeChatSetup.exe -o/tmp/wechatdir/drive_c/Program\ Files/Tencent/WeChat
  rm /opt/apps/com.qq.weixin.deepin/files/files.7z
  7z a -t7z -r /opt/apps/com.qq.weixin.deepin/files/files.7z /tmp/wechatdir/*
  md5sum /opt/apps/com.qq.weixin.deepin/files/files.7z | awk '{ print $1 }' > /opt/apps/com.qq.weixin.deepin/files/files.md5sum
  rm -rf /tmp/wechatdir /tmp/WeChatSetup.exe
  apt remove -y wget
  apt -y autoremove --purge

  rm -rvf /usr/share/icons/Adwaita 
  find /var/lib/apt/lists -type f -delete 
  find /var/cache -type f -delete 
  find /var/log -type f -delete 
  find /usr/share/doc -type f -delete 
  find /usr/share/man -type f -delete 
  find /usr/share/locale -type f -delete

%environment
  export GTK_IM_MODULE="fcitx"
  export XMODIFIERS="@im=fcitx" 
  export QT_IM_MODULE="fcitx"
  export LANG=zh_CN.UTF-8
  export LANGUAGE=zh_CN.UTF-8 
  export LC_ALL=zh_CN.UTF-8 
  export LANG=zh_CN.UTF-8 
  export TZ=UTC-8

%files
  keyrings/deepin-archive-keyring.gpg /etc/apt/trusted.gpg.d/
  keyrings/appstore.gpg   /etc/apt/trusted.gpg.d/
  sources.list /etc/apt/

